import struct
import socket


def scannerIp(stringIp):
    sock = socket.socket(socket.AF_INET)
    sock.settimeout(3)
    sock.connect((stringIp, 445))
    packet = b'\x00\x00\x00\xc0\xfeSMB@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00$\x00\x08\x00\x01\x00\x00\x00\x7f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00x\x00\x00\x00\x02\x00\x00\x00\x02\x02\x10\x02"\x02$\x02\x00\x03\x02\x03\x10\x03\x11\x03\x00\x00\x00\x00\x01\x00&\x00\x00\x00\x00\x00\x01\x00 \x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\n\x00\x00\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'
    sock.send(packet)
    length = sock.recv(4)
    # print(length)
    nb, = struct.unpack(">I", length)
    # print(nb)
    result = sock.recv(nb)
    # if not result[68:70] == b"\x11\x03":
    #
    #     print("Not vulnerable")
    # if not result[70:72] == b"\x02\x00":
    #     print("Not vulnerable")
    # print("Vulnerable")
    # if result[68:70] == b"\x11\x03":
    #     exit("vulnerable")
    # if result[70:72] == b"\x02\x00":
    #     exit("vulnerable")
    # exit("Not Vulnerable")
    # print(result[68:70])
    # print(result[70:72])
    # ifVulnerable = False
    if result[68:72] != b"\x11\x03\x02\x00":
        print("Not Vulnerable")
        ifVulnerable = False
        return False
    else:
        print("vulnerable")
        ifVulnerable  = True
        return True
    return False
    exit()


# scannerIp()